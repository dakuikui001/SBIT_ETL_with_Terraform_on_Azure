name: Databricks Bundle Deployment & Test

on:
  push:
    branches:
      - main
    # ğŸŒŸ å»ºè®®ï¼šæš‚æ—¶æŠŠè¿™é‡Œçš„ paths æ³¨é‡Šæ‰ï¼Œæˆ–è€…æ”¹ä¸€ä¸ªä¸å­˜åœ¨çš„åˆ†æ”¯ï¼Œé˜²æ­¢å®ƒåœ¨ä½ é‡å»ºç¯å¢ƒæ—¶æ£ä¹±
    paths:
      - 'sbit_medallion_pipeline/src/**'
      - 'sbit_medallion_pipeline/tests/**'
      - 'sbit_medallion_pipeline/resources/**'
      - 'sbit_medallion_pipeline/databricks.yml'

jobs:
  deploy_and_test:
    runs-on: ubuntu-latest
    
    defaults:
      run:
        working-directory: ./sbit_medallion_pipeline

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Databricks SDK & CLI
        run: |
          pip install databricks-sdk
          curl -fsSL https://raw.githubusercontent.com/databricks/setup-cli/main/install.sh | sh

      # ğŸŒŸ ä»¥ä¸‹æ­¥éª¤æš‚æ—¶æ³¨é‡Šæ‰ï¼Œç›´åˆ°ä½ æ›´æ–°äº† GitHub Secrets é‡Œçš„ HOST å’Œ TOKEN
      # - name: Deploy Bundle to Dev
      #   run: databricks bundle deploy -t dev
      #   env:
      #     DATABRICKS_HOST: ${{ secrets.DATABRICKS_HOST }}
      #     DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}

      # - name: Run Integration Test
      #   run: databricks bundle run sbit_integration_test_job -t dev
      #   env:
      #     DATABRICKS_HOST: ${{ secrets.DATABRICKS_HOST }}
      #     DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}

      - name: Notice
        run: echo "Databricks steps are temporarily disabled during environment rebuild."